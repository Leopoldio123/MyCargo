<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–µ—Ä–µ–≤–æ–∑–∫—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); padding: 20px; padding-bottom: 80px; }
        .container { max-width: 600px; margin: 0 auto; }
        h2 { border-bottom: 2px solid var(--tg-theme-button-color, #3390ec); padding-bottom: 10px; margin-top: 30px; font-size: 18px; }
        .card { background: var(--tg-theme-secondary-bg-color, #f5f5f5); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #e0e0e0; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 13px; color: var(--tg-theme-hint-color, #555); }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; background: #fff; }
        .btn-add { background: transparent; color: var(--tg-theme-button-color, #3390ec); border: 2px dashed var(--tg-theme-button-color, #3390ec); width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; margin-top: 10px; font-weight: bold; }
        .section-title { font-size: 1.1em; font-weight: bold; margin-bottom: 15px; color: var(--tg-theme-text-color, #000); }
        .row { display: flex; gap: 10px; }
        .row input { width: 50%; }
    </style>
</head>
<body>
<div class="container">
    <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –≥—Ä—É–∑–∞</h1>

    <div class="section">
        <h2>üë§ –ó–∞–∫–∞–∑—á–∏–∫</h2>
        
        <label>–¢–∏–ø –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞</label>
        <select id="clientType">
            <option value="–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–æ–µ –ª–∏—Ü–æ</option>
            <option value="–ò–ü">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å</option>
            <option value="–ß–∞—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ">–ß–∞—Å—Ç–Ω–æ–µ –ª–∏—Ü–æ</option>
        </select>

        <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ / –§–ò–û</label>
        <input type="text" id="companyName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û–û–û –†–æ–º–∞—à–∫–∞">

        <label>–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å (–§–ò–û)</label>
        <input type="text" id="repName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">

        <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="tel" id="repPhone" placeholder="+7...">
    </div>

    <div class="section">
        <h2>‚¨ÜÔ∏è –ú–µ—Å—Ç–∞ –ø–æ–≥—Ä—É–∑–∫–∏</h2>
        <div id="loadingPoints"></div>
        <button class="btn-add" onclick="addLoadingPoint()">+ –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å –ø–æ–≥—Ä—É–∑–∫–∏</button>
    </div>

    <div class="section">
        <h2>‚¨áÔ∏è –ú–µ—Å—Ç–∞ –≤—ã–≥—Ä—É–∑–∫–∏</h2>
        <div id="unloadingPoints"></div>
        <button class="btn-add" onclick="addUnloadingPoint()">+ –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å –≤—ã–≥—Ä—É–∑–∫–∏</button>
    </div>
</div>

<script>
    // === –í–°–¢–ê–í–¨–¢–ï –í–ê–®–£ –°–°–´–õ–ö–£ –ù–ò–ñ–ï ===
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzcR-gp4slybVKvF2CPZik5EhuIQdMRVb95c4nL0pl0qIH0kd8CM8UwS5rRh9u9i5eK/exec'; 
    // =================================

    let tg = window.Telegram.WebApp;
    tg.expand(); 

    // –®–∞–±–ª–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ –ü–û–ì–†–£–ó–ö–ò
    function createLoadingHTML(index) {
        return `
        <div class="card loading-card">
            <div class="section-title">–¢–æ—á–∫–∞ –ø–æ–≥—Ä—É–∑–∫–∏ ${index + 1}</div>
            
            <label>–ê–¥—Ä–µ—Å –ø–æ–≥—Ä—É–∑–∫–∏</label>
            <input type="text" class="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º">

            <label>–•–∞—Ä–∞–∫—Ç–µ—Ä –≥—Ä—É–∑–∞</label>
            <input type="text" class="cargoType" placeholder="–ù–∞–ø—Ä: –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ, –ü–∞–ª–ª–µ—Ç—ã">

            <div class="row">
                <div>
                    <label>–í–µ—Å (–∫–≥)</label>
                    <input type="number" class="cargoWeight" placeholder="1500">
                </div>
                <div>
                    <label>–ì–∞–±–∞—Ä–∏—Ç—ã (–î—Ö–®—Ö–í)</label>
                    <input type="text" class="cargoDims" placeholder="1.2 x 0.8 x 2">
                </div>
            </div>

            <label>–¢–∏–ø –ø–æ–≥—Ä—É–∑–∫–∏</label>
            <input type="text" class="loadType" placeholder="–ù–∞–ø—Ä: –ó–∞–¥–Ω—è—è, –ë–æ–∫–æ–≤–∞—è">

            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –Ω–∞ –ø–æ–≥—Ä—É–∑–∫–µ</label>
            <input type="text" class="contactName" placeholder="–§–ò–û, –¢–µ–ª–µ—Ñ–æ–Ω">
        </div>`;
    }

    // –®–∞–±–ª–æ–Ω –∫–∞—Ä—Ç–æ—á–∫–∏ –í–´–ì–†–£–ó–ö–ò
    function createUnloadingHTML(index) {
        return `
        <div class="card unloading-card">
            <div class="section-title">–¢–æ—á–∫–∞ –≤—ã–≥—Ä—É–∑–∫–∏ ${index + 1}</div>
            
            <label>–ê–¥—Ä–µ—Å –≤—ã–≥—Ä—É–∑–∫–∏</label>
            <input type="text" class="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º">

            <label>–¢–∏–ø –≤—ã–≥—Ä—É–∑–∫–∏</label>
            <input type="text" class="unloadType" placeholder="–ù–∞–ø—Ä: –ó–∞–¥–Ω—è—è, –†—É—á–Ω–∞—è">

            <label>–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –≤—ã–≥—Ä—É–∑–∫–µ</label>
            <select class="docsType">
                <option value="–ü–µ—á–∞—Ç—å">–ü–µ—á–∞—Ç—å</option>
                <option value="–î–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å">–î–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</option>
                <option value="–ë–µ–∑ –ø–µ—á–∞—Ç–∏">–ë–µ–∑ –ø–µ—á–∞—Ç–∏</option>
            </select>

            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –Ω–∞ –≤—ã–≥—Ä—É–∑–∫–µ</label>
            <input type="text" class="contactName" placeholder="–§–ò–û, –¢–µ–ª–µ—Ñ–æ–Ω">
        </div>`;
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    function addLoadingPoint() {
        let container = document.getElementById('loadingPoints');
        let div = document.createElement('div');
        div.innerHTML = createLoadingHTML(container.children.length);
        container.appendChild(div);
    }

    function addUnloadingPoint() {
        let container = document.getElementById('unloadingPoints');
        let div = document.createElement('div');
        div.innerHTML = createUnloadingHTML(container.children.length);
        container.appendChild(div);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ –æ–¥–Ω–æ–π —Ç–æ—á–∫–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    addLoadingPoint();
    addUnloadingPoint();

    tg.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£");
    tg.MainButton.show();

    // –°–ë–û–† –î–ê–ù–ù–´–• –ò –û–¢–ü–†–ê–í–ö–ê
    tg.MainButton.onClick(function() {
        tg.MainButton.showProgress();

        // –°–æ–±–∏—Ä–∞–µ–º –ø–æ–≥—Ä—É–∑–∫—É
        let loadPoints = [];
        document.querySelectorAll('.loading-card').forEach(card => {
            loadPoints.push({
                address: card.querySelector('.address').value,
                cargo: card.querySelector('.cargoType').value,
                weight: card.querySelector('.cargoWeight').value,
                dims: card.querySelector('.cargoDims').value,
                type: card.querySelector('.loadType').value,
                contact: card.querySelector('.contactName').value
            });
        });

        // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–≥—Ä—É–∑–∫—É
        let unloadPoints = [];
        document.querySelectorAll('.unloading-card').forEach(card => {
            unloadPoints.push({
                address: card.querySelector('.address').value,
                type: card.querySelector('.unloadType').value,
                docs: card.querySelector('.docsType').value,
                contact: card.querySelector('.contactName').value
            });
        });

        let data = {
            client_type: document.getElementById('clientType').value,
            company: document.getElementById('companyName').value,
            rep_name: document.getElementById('repName').value,
            rep_phone: document.getElementById('repPhone').value,
            loading: loadPoints,
            unloading: unloadPoints
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        }).then(() => {
            tg.MainButton.hideProgress();
            tg.showAlert("–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
            tg.close();
        }).catch(err => {
            tg.MainButton.hideProgress();
            tg.showAlert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏.");
        });
    });
</script>
</body>
</html>
