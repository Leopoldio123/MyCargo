<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–µ—Ä–µ–≤–æ–∑–∫—É</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        h2 { border-bottom: 2px solid var(--tg-theme-button-color, #3390ec); padding-bottom: 10px; margin-top: 30px; }
        .card { background: var(--tg-theme-secondary-bg-color, #f5f5f5); padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        label { display: block; margin-top: 10px; font-weight: bold; font-size: 14px; }
        input { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn-add { background: transparent; color: var(--tg-theme-button-color, #3390ec); border: 1px dashed var(--tg-theme-button-color, #3390ec); width: 100%; padding: 10px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        .section-title { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏</h1>

    <div class="section">
        <h2>–ó–∞–∫–∞–∑—á–∏–∫</h2>
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
        <input type="text" id="companyName" placeholder="–û–û–û –í–µ–∫—Ç–æ—Ä">
        <label>–§–ò–û –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è</label>
        <input type="text" id="repName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">
        <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω</label>
        <input type="tel" id="repPhone" placeholder="+7...">
    </div>

    <div class="section">
        <h2>üìç –ú–µ—Å—Ç–∞ –ø–æ–≥—Ä—É–∑–∫–∏</h2>
        <div id="loadingPoints">
            </div>
        <button class="btn-add" onclick="addPoint('loading')">+ –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å –ø–æ–≥—Ä—É–∑–∫–∏</button>
    </div>

    <div class="section">
        <h2>üèÅ –ú–µ—Å—Ç–∞ –≤—ã–≥—Ä—É–∑–∫–∏</h2>
        <div id="unloadingPoints">
            </div>
        <button class="btn-add" onclick="addPoint('unloading')">+ –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å –≤—ã–≥—Ä—É–∑–∫–∏</button>
    </div>
</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand(); // –†–∞—Å–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –∞–¥—Ä–µ—Å–∞
    function createPointHTML(type, index) {
        let labelType = type === 'loading' ? '–ü–æ–≥—Ä—É–∑–∫–∞' : '–í—ã–≥—Ä—É–∑–∫–∞';
        return `
        <div class="card" id="${type}-${index}">
            <div class="section-title">–¢–æ—á–∫–∞ ${index + 1}</div>
            <label>–ê–¥—Ä–µ—Å</label>
            <input type="text" class="address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º">
            <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ (–§–ò–û)</label>
            <input type="text" class="contactName" placeholder="–ü–µ—Ç—Ä–æ–≤ –ü.–ü.">
            <label>–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
            <input type="text" class="contactPos" placeholder="–ö–ª–∞–¥–æ–≤—â–∏–∫">
            <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" class="contactPhone" placeholder="+7...">
        </div>`;
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ –æ–¥–Ω–æ–π —Ç–æ—á–∫–µ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    addPoint('loading');
    addPoint('unloading');

    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ç–æ—á–∫–∏
    function addPoint(type) {
        let container = document.getElementById(type + 'Points');
        let count = container.children.length;
        let div = document.createElement('div');
        div.innerHTML = createPointHTML(type, count);
        container.appendChild(div);
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ Telegram
    tg.MainButton.setText("–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£");
    tg.MainButton.show();

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
   // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    tg.MainButton.onClick(function() {
        tg.MainButton.showProgress(); // –ü–æ–∫–∞–∑–∞—Ç—å –∫—Ä—É—Ç–∏–ª–∫—É –∑–∞–≥—Ä—É–∑–∫–∏

        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        let data = {
            company: document.getElementById('companyName').value,
            rep_name: document.getElementById('repName').value,
            rep_phone: document.getElementById('repPhone').value,
            loading: collectPoints('loading'),
            unloading: collectPoints('unloading')
        };

        // URL –≤–∞—à–µ–≥–æ Google Script (–í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π!)
        let scriptURL = "https://script.google.com/macros/s/AKfycbxyZ8c5HJtwv1AS2mvpoh7IFJRR8dC6LnaxAuuA7fLEB1oiLuhVmEpH1Pj01XxHyiWK/exec";

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä Google
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // –í–∞–∂–Ω–æ –¥–ª—è Google Scripts
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(res => {
            // –ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ —É—à–ª–∏ —É—Å–ø–µ—à–Ω–æ
            tg.MainButton.hideProgress();
            tg.showAlert("–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!");
            tg.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ
        }).catch(err => {
            tg.MainButton.hideProgress();
            tg.showAlert("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.");
        });
    });
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        let data = {
            company: document.getElementById('companyName').value,
            rep_name: document.getElementById('repName').value,
            rep_phone: document.getElementById('repPhone').value,
            loading: collectPoints('loading'),
            unloading: collectPoints('unloading')
        };
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É (–≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON —Å—Ç—Ä–æ–∫–∏)
        tg.sendData(JSON.stringify(data));
    });

    // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π
    function collectPoints(type) {
        let container = document.getElementById(type + 'Points');
        let points = [];
        for (let item of container.children) {
            points.push({
                address: item.querySelector('.address').value,
                contact: item.querySelector('.contactName').value,
                position: item.querySelector('.contactPos').value,
                phone: item.querySelector('.contactPhone').value
            });
        }
        return points;
    }
</script>
</body>

</html>
